 <% layout("/layouts/boilerplate") -%>



<button class="back-button" onclick="goBack()">
  <i class="fas fa-arrow-left"></i>
</button>

<!-- Hero Section -->
<div class="hero-section mb-5">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-lg-6">
        <h1 class="hero-title">Find Your Perfect Stay</h1>
        <p class="hero-subtitle">Discover comfortable and affordable accommodations for your next adventure</p>
        <div class="search-box">
          <div class="input-group">
            <span class="input-group-text bg-white border-end-0">
              <i class="bi bi-search"></i>
            </span>
            <input type="text" class="form-control border-start-0" placeholder="Search by location...">
            <button class="btn btn-primary px-4">Search</button>
          </div>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="hero-image">
          <img src="https://images.unsplash.com/photo-1566073771259-6a8506099945?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2070&q=80" alt="Hero Image">
        </div>
      </div>
    </div>
  </div>
</div>

<div class="">
  <!-- Filter Section -->
<div class="filter-section mb-4">
  <div class="filter-container">
    <div class="filter-header d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center gap-3">
      
      <!-- Heading Section -->
      <div class="header-left text-center text-lg-start">
        <h2 class="section-title mb-1">Available Properties</h2>
        <p class="filter-subtitle mb-0">Find your perfect stay with our advanced filters</p>
      </div>

      <!-- Buttons Section -->
      <div class="filter-actions d-flex flex-column flex-sm-row justify-content-center align-items-center gap-2">
        <button type="button" class="btn btn-sm btn-primary d-flex align-items-center gap-2 px-4 py-2" data-bs-toggle="modal" data-bs-target="#filterModal">
          <i class="fas fa-filter"></i>
          <span>Filter</span>
        </button>
        <button type="button" class="btn btn-sm btn-outline-primary d-flex align-items-center gap-2 px-4 py-2" id="resetButton">
          <i class="fas fa-undo"></i>
          <span>Reset</span>
        </button>
      </div>
    </div>
  </div>
</div>


  <!-- Filter Modal -->
  <div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
          <h5 class="modal-title" id="filterModalLabel">
            <i class="fas fa-sliders-h me-2"></i>Filter Properties
          </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
          <!-- Gender Filter -->
          <div class="filter-group">
            <h6 class="filter-title">
              <i class="fas fa-venus-mars me-2"></i>Gender Preference
            </h6>
            <div class="filter-options">
              <div class="form-check">
                <input class="form-check-input gender-input" type="radio" name="gender" id="genderAll" value="" checked>
              <label class="form-check-label" for="genderAll">All</label>
            </div>
              <div class="form-check">
                <input class="form-check-input gender-input" type="radio" name="gender" id="genderMale" value="Male">
              <label class="form-check-label" for="genderMale">Male</label>
            </div>
              <div class="form-check">
                <input class="form-check-input gender-input" type="radio" name="gender" id="genderFemale" value="Female">
              <label class="form-check-label" for="genderFemale">Female</label>
            </div>
              <div class="form-check">
                <input class="form-check-input gender-input" type="radio" name="gender" id="genderOther" value="Other">
              <label class="form-check-label" for="genderOther">Other</label>
              </div>
            </div>
        </div>

          <!-- Rent Range -->
          <div class="filter-group">
            <h6 class="filter-title">Rent Range</h6>
            <div class="rent-range">
              <div class="input-group">
                <span class="input-group-text">₹</span>
                <input type="number" class="form-control" id="minRent" placeholder="Min">
              </div>
              <div class="input-group">
                <span class="input-group-text">₹</span>
                <input type="number" class="form-control" id="maxRent" placeholder="Max">
              </div>
            </div>
        </div>

          <!-- Amenities -->
          <div class="filter-group">
            <h6 class="filter-title">Amenities</h6>
            <div class="amenities-grid">
              <div class="form-check">
                <input class="form-check-input amenities-input" type="checkbox" id="amenityAC" value="AC">
                <label class="form-check-label" for="amenityAC">
                  <i class="fas fa-snowflake"></i> AC
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input amenities-input" type="checkbox" id="amenityWiFi" value="Wi-Fi">
                <label class="form-check-label" for="amenityWiFi">
                  <i class="fas fa-wifi"></i> Wi-Fi
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input amenities-input" type="checkbox" id="amenityParking" value="Parking">
                <label class="form-check-label" for="amenityParking">
                  <i class="fas fa-parking"></i> Parking
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input amenities-input" type="checkbox" id="amenityGym" value="Gym">
                <label class="form-check-label" for="amenityGym">
                  <i class="fas fa-dumbbell"></i> Gym
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input amenities-input" type="checkbox" id="amenityFood" value="Food">
                <label class="form-check-label" for="amenityFood">
                  <i class="fas fa-utensils"></i> Food
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input amenities-input" type="checkbox" id="amenityLaundry" value="Laundry">
                <label class="form-check-label" for="amenityLaundry">
                  <i class="fas fa-tshirt"></i> Laundry
                </label>
              </div>
            </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-primary" id="applyFilter">
          <i class="fas fa-check me-2"></i>Apply Filters
        </button>
      </div>
    </div>
  </div>
</div>

  <!-- Listings Grid -->
  <div class="row g-4" id="imageContainer">
    <% for (let listing of allListing) { %>
      <div class="col-lg-4 col-md-6 col-sm-12">
        <div class="listing-card">
          <a href="/listings/<%= listing._id %>" class="text-decoration-none">
            <div class="card-wrapper">
              <!-- Image Section -->
              <div class="card-image">
                <img src="<%= listing.image[0]?.url %>" alt="listing_img" />
                <div class="card-overlay">
                  <div class="card-price">
                    <i class="fas fa-rupee-sign"></i>
                    <%= listing.rent.toLocaleString("en-IN") %>/month
                  </div>
                  <div class="card-actions">
                    <button class="action-btn-heart favorite-btn" title="Add to Favorites">
                      <i class="fas fa-heart"></i>
                    </button>
                  </div>
                </div>
              </div>

              <!-- Content Section -->
              <div class="card-content">
                <div class="card-header">
                  <div class="card-title">
                    <h3><%= listing.title %></h3>
                    <div class="location">
                      <i class="bi bi-geo-alt"></i>
                      <span><%= listing.location %></span>
                    </div>
                  </div>
                  <% if (listing.availability) { %>
                    <div class="status-badge available">Available</div>
                  <% } else { %>
                    <div class="status-badge unavailable">Unavailable</div>
                  <% } %>
                </div>

                <div class="card-features">
                  <div class="feature">
                    <span><%= listing.capacity %> Guests</span>
                  </div>
                  <div class="feature">
                    <span><%= listing.bedrooms %> Bedroom</span>
                  </div>
                  <div class="feature">
                    <span><%= listing.bathrooms %> Bath</span>
                  </div>
                </div>

                <div class="card-footer">
                  <div class="rating">
                    <div class="stars">
                      <i class="fas fa-star"></i>
                      <i class="fas fa-star"></i>
                      <i class="fas fa-star"></i>
                      <i class="fas fa-star"></i>
                      <i class="fas fa-star-half-alt"></i>
                    </div>
                    <span class="rating-count">(24 reviews)</span>
                  </div>
                  
                </div>
          </div>
        </div>
      </a>
        </div>
      </div>
    <% } %>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const filterModal = document.getElementById('filterModal');
  const applyFilterBtn = document.getElementById('applyFilter');
  const resetButton = document.getElementById('resetButton');
  const genderInputs = document.querySelectorAll('.gender-input');
  const amenitiesInputs = document.querySelectorAll('.amenities-input');
  const minRentInput = document.getElementById('minRent');
  const maxRentInput = document.getElementById('maxRent');
  const modal = new bootstrap.Modal(filterModal);

  // Apply filters
  applyFilterBtn.addEventListener('click', async function() {
    // Get selected gender
    const selectedGender = document.querySelector('input[name="gender"]:checked').value;

    // Get selected amenities
    const selectedAmenities = Array.from(amenitiesInputs)
      .filter(input => input.checked)
      .map(input => input.value);

    // Get rent range
    const minRent = minRentInput.value;
    const maxRent = maxRentInput.value;

    // Build query parameters
    const queryParams = new URLSearchParams();
    
    if (selectedGender) {
      queryParams.append('gender', selectedGender);
    }
    if (selectedAmenities.length > 0) {
      queryParams.append('amenities', selectedAmenities.join(','));
    }
    if (minRent) {
      queryParams.append('minRent', minRent);
    }
    if (maxRent) {
      queryParams.append('maxRent', maxRent);
    }

    try {
      const response = await fetch(`/filter?${queryParams.toString()}`);
    const data = await response.json();

      const imageContainer = document.getElementById('imageContainer');
      imageContainer.innerHTML = '';

    if (data.success && data.listings.length > 0) {
      data.listings.forEach(listing => {
        const cardHTML = `
            <div class="col-lg-4 col-md-6 col-sm-12">
              <div class="listing-card">
                <a href="/listings/${listing._id}" class="text-decoration-none">
                  <div class="card-wrapper">
                    <div class="card-image">
                      <img src="${listing.image[0]?.url}" alt="listing_img" />
                      <div class="card-overlay">
                        <div class="card-price">
                          <i class="fas fa-rupee-sign"></i>
                          ${listing.rent.toLocaleString("en-IN")}/month
                        </div>
                        <div class="card-actions">
                          <button class="action-btn-heart favorite-btn" title="Add to Favorites">
                            <i class="fas fa-heart"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                    <div class="card-content">
                      <div class="card-header">
                        <div class="card-title">
                          <h3>${listing.title}</h3>
                          <div class="location">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${listing.location}</span>
                          </div>
                        </div>
                        <div class="status-badge available">Available</div>
                      </div>
                      <div class="card-features">
                        <div class="feature">
                          <i class="fas fa-users"></i>
                          <span>2 Guests</span>
                        </div>
                        <div class="feature">
                          <i class="fas fa-door-open"></i>
                          <span>1 Bedroom</span>
                        </div>
                        <div class="feature">
                          <i class="fas fa-bath"></i>
                          <span>1 Bath</span>
                        </div>
                      </div>
                      <div class="card-footer">
                        <div class="rating">
                          <div class="stars">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                          </div>
                          <span class="rating-count">(24 reviews)</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </a>
              </div>
            </div>
        `;
          imageContainer.insertAdjacentHTML('beforeend', cardHTML);
      });
    } else {
        imageContainer.innerHTML = `
          <div class="col-12 text-center py-5">
            <i class="fas fa-search fa-3x mb-3 text-muted"></i>
            <h3>No properties found</h3>
            <p class="text-muted">Try adjusting your filters to find what you're looking for.</p>
          </div>
        `;
      }

      // Close the modal after applying filters
      modal.hide();
    } catch (error) {
      console.error('Error applying filters:', error);
      alert('An error occurred while applying filters. Please try again.');
    }
  });

  // Reset filters
  resetButton.addEventListener('click', function() {
    // Reset gender to "All"
    document.getElementById('genderAll').checked = true;

    // Reset amenities
    amenitiesInputs.forEach(input => input.checked = false);

    // Reset rent range
    minRentInput.value = '';
    maxRentInput.value = '';

    // Apply the reset filters
    applyFilters();
  });

  // Function to apply filters
  async function applyFilters() {
    const selectedGender = document.querySelector('input[name="gender"]:checked').value;
    const selectedAmenities = Array.from(amenitiesInputs)
      .filter(input => input.checked)
      .map(input => input.value);
    const minRent = minRentInput.value;
    const maxRent = maxRentInput.value;

    const queryParams = new URLSearchParams();
    
    if (selectedGender) {
      queryParams.append('gender', selectedGender);
    }
    if (selectedAmenities.length > 0) {
      queryParams.append('amenities', selectedAmenities.join(','));
    }
    if (minRent) {
      queryParams.append('minRent', minRent);
    }
    if (maxRent) {
      queryParams.append('maxRent', maxRent);
    }

    try {
      const response = await fetch(`/filter?${queryParams.toString()}`);
      const data = await response.json();

      const imageContainer = document.getElementById('imageContainer');
      imageContainer.innerHTML = '';

      if (data.success && data.listings.length > 0) {
        data.listings.forEach(listing => {
          const cardHTML = `
            <div class="col-lg-4 col-md-6 col-sm-12">
              <div class="listing-card">
                <a href="/listings/${listing._id}" class="text-decoration-none">
                  <div class="card-wrapper">
                    <div class="card-image">
                      <img src="${listing.image[0]?.url}" alt="listing_img" />
                      <div class="card-overlay">
                        <div class="card-price">
                          <i class="fas fa-rupee-sign"></i>
                          ${listing.rent.toLocaleString("en-IN")}/month
                        </div>
                        <div class="card-actions">
                          <button class="action-btn-heart favorite-btn" title="Add to Favorites">
                            <i class="fas fa-heart"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                    <div class="card-content">
                      <div class="card-header">
                        <div class="card-title">
                          <h3>${listing.title}</h3>
                          <div class="location">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${listing.location}</span>
                          </div>
                        </div>
                        <div class="status-badge available">Available</div>
                      </div>
                      <div class="card-features">
                        <div class="feature">
                          <i class="fas fa-users"></i>
                          <span>2 Guests</span>
                        </div>
                        <div class="feature">
                          <i class="fas fa-door-open"></i>
                          <span>1 Bedroom</span>
                        </div>
                        <div class="feature">
                          <i class="fas fa-bath"></i>
                          <span>1 Bath</span>
                        </div>
                      </div>
                      <div class="card-footer">
                        <div class="rating">
                          <div class="stars">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                          </div>
                          <span class="rating-count">(24 reviews)</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </a>
              </div>
            </div>
          `;
          imageContainer.insertAdjacentHTML('beforeend', cardHTML);
        });
      } else {
        imageContainer.innerHTML = `
          <div class="col-12 text-center py-5">
            <i class="fas fa-search fa-3x mb-3 text-muted"></i>
            <h3>No properties found</h3>
            <p class="text-muted">Try adjusting your filters to find what you're looking for.</p>
          </div>
        `;
      }
    } catch (error) {
      console.error('Error applying filters:', error);
      alert('An error occurred while applying filters. Please try again.');
    }
  }
});

function goBack() {
  window.history.back();
}
</script>
